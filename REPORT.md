# Отчет: качество обнаружения и шаги по улучшению

## Что делает текущая базовая линия

- Запускает Ultralytics YOLO для каждого кадра и сохраняет только обнаруженные лица.
- Рисует тонкие ограничивающие рамки и маленькую метку (`person <conf>`).

Это хорошая отправная точка, потому что модели YOLO, предварительно обученные на COCO, обычно хорошо распознают людей,
но в видеороликах с участием толпы часто обнаруживаются типичные сбои.

## Ожидаемые сбои в сценах с большим количеством людей

1. **Перекрытия и накладки**
   - Люди, частично скрытые другими, часто не обнаруживаются.
   - Плотное перекрытие может привести к тому, что NMS будет подавлять истинные положительные результаты.

2. **Мелкие объекты**
   - Люди, находящиеся на большом расстоянии, могут быть очень маленькими в пикселях, что не соответствует эффективному масштабу детектора.

3. **Артефакты размытия/ сжатия изображения при движении**
   - Быстрое движение, слабая освещенность или сильное сжатие могут снизить достоверность снимка и увеличить количество промахов.

4. **Ложные срабатывания**
   - Плакаты, манекены, отражения и подобные узоры могут быть распознаны как люди.

## Практические шаги по улучшению качества (по порядку)

1. **Выберите более надежную модель**
   - Сначала попробуйте `yolov8s.pt` или `yolov8m.pt`. Более крупные модели обычно улучшают память у людей маленького роста или с закрытыми глазами.
   - Если вы хотите использовать только процессор, сбалансируйте качество и скорость (например, "yolov8s" может работать медленнее).

2. **Настройка порога**
   - В случае скопления людей понижение значения "--conf" может увеличить скорость отзыва, но может привести к ложным срабатываниям.
   - Измените значение "-долговая расписка", чтобы уменьшить помехи для окружающих (иногда, если немного увеличить размер расписки, можно сохранить больше коробок).

3. **Увеличьте эффективное разрешение**
   - Если видео с низким разрешением, рассмотрите:
     - выполнение логического вывода на увеличенном фрейме (простое изменение размера),
- или разбивка фрейма на перекрывающиеся участки (лучше для очень маленьких пользователей).
   - Разбиение на листы требует больших вычислительных ресурсов, но может значительно повысить эффективность поиска небольших объектов.

4. **Временная согласованность с помощью отслеживания**
   - Добавление трекера (например, ByteTrack/DeepSORT) поверх обнаружений.
   - Преимущества:
     - более плавные рамки (меньше мерцания),
- возможность фильтрации кратковременных ложных срабатываний,
- лучшее качество восприятия, даже если исходное качество детектора не изменилось.

5. **Тонкая настройка освещения**
   - Выделите ~200-500 кадров (или обрезки) из целевого видео и точно настройте детектор.
   - Это помогает адаптироваться к углу обзора камеры, распределению одежды, освещению и фону.

6. **Интеллектуальная постобработка**
   - Применяйте ограничения размера бокса с учетом перспективы (если камера установлена неподвижно).
   - Рассмотрите возможность плавного или взвешенного слияния боксов в плотных сценах.

## Как оценить улучшения

- Выборка и ручной просмотр фиксированного набора кадров (например, каждого N-го кадра).
- Отслеживание:
  - пропущенных людей (ложноотрицательные результаты),
- обнаружение призраков (ложноположительные результаты),
- стабильность во времени (мерцание).
- Если позволяет время, прокомментируйте небольшой набор тестов и вычислите карту / точность / отзыв.
